{"version":3,"sources":["run-tests.js"],"names":[],"mappings":"AAAA,MAAM,KAAK,QAAQ,IAAR,CAAX;AACA,MAAM,MAAM,QAAQ,YAAR,CAAZ;AACA,MAAM,OAAO,QAAQ,eAAR,EAAyB,IAAtC;AACA,MAAM,OAAO,QAAQ,MAAR,CAAb;;AAEA,SAAS,KAAT,CAAe,QAAf,EAAyB;AACrB,WAAO,GAAG,UAAH,CAAc,QAAd,IAA0B,OAAO,GAAG,YAAH,CAAgB,QAAhB,CAAP,CAA1B,GAA8D,EAArE;AACH;;AAED,MAAM,cAAe,GAAG,UAAH,CAAc,OAAd,IAAyB,OAAzB,GAAmC,aAAxD;;AAEA,MAAM,QAAQ,GAAG,WAAH,CAAe,WAAf,EAA4B,MAA5B,CAAmC,UAAS,QAAT,EAAmB;AAChE,WAAO,CAAC,YAAY,IAAZ,CAAiB,QAAjB,CAAD,IAA+B,CAAC,WAAW,IAAX,CAAgB,QAAhB,CAAvC;AACH,CAFa,CAAd;;AAIA,SAAS,GAAT,CAAa,IAAb,EAAmB;AACf,aAAS,UAAT,CAAoB,OAApB,EAA6B,GAA7B,EAAkC,IAAlC,EAAwC;AACpC,YAAI,QAAQ,OAAZ,EAAqB;AACjB,kBAAM,QAAQ,KAAK,WAAL,CAAiB,IAAjB,EAAuB,OAAvB,EAAgC,GAAhC,CAAd;AACA,oBAAQ,MAAR,CAAe,KAAf,CAAqB,KAArB;AACA,oBAAQ,MAAR,CAAe,KAAf,CAAqB,MAArB;AACH;AACJ;;AAED,UAAM,WAAW,KAAK,KAAL,CAAW,CAAX,EAAc,CAAC,CAAf,CAAjB;AACA,SAAK,IAAI,0BAAJ,EAAgC,IAAhC,EAAsC,IAAtC,EAA4C,WAA5C,EAAyD,IAAzD,CAAL,EAAqE,UAAS,KAAT,EAAgB,MAAhB,EAAwB,MAAxB,EAAgC;AACjG,iBAAS,UAAU,EAAnB;AACA,iBAAS,UAAU,EAAnB;AACA,cAAM,iBAAiB,MAAM,IAAI,gBAAJ,EAAsB,WAAtB,EAAmC,QAAnC,CAAN,CAAvB;AACA,cAAM,iBAAiB,MAAM,IAAI,gBAAJ,EAAsB,WAAtB,EAAmC,QAAnC,CAAN,CAAvB;;AAEA,cAAM,OAAQ,WAAW,cAAX,IAA6B,WAAW,cAAtD;;AAEA,YAAI,CAAC,IAAL,EAAW;AACP,oBAAQ,GAAR,CAAY,IAAI,iBAAJ,EAAuB,IAAvB,CAAZ;AACH;AACD,mBAAW,cAAX,EAA2B,MAA3B,EAAmC,IAAI,YAAJ,EAAkB,IAAlB,CAAnC;AACA,mBAAW,cAAX,EAA2B,MAA3B,EAAmC,IAAI,YAAJ,EAAkB,IAAlB,CAAnC;AACH,KAbD;AAcH;;AAED,MAAM,OAAO,QAAQ,IAAR,CAAa,CAAb,CAAb;AACA,MAAM,OAAQ,QAAQ,IAAR,CAAa,CAAb,MAAoB,KAApB,GAA4B,EAA5B,GAAiC,WAA/C;AACA,MAAM,OAAN,CAAc,GAAd","file":"run-tests-compiled.js","sourcesContent":["const fs = require(\"fs\");\nconst fmt = require(\"simple-fmt\");\nconst exec = require(\"child_process\").exec;\nconst diff = require(\"diff\");\n\nfunction slurp(filename) {\n    return fs.existsSync(filename) ? String(fs.readFileSync(filename)) : \"\";\n}\n\nconst pathToTests = (fs.existsSync(\"tests\") ? \"tests\" : \"../../tests\");\n\nconst tests = fs.readdirSync(pathToTests).filter(function(filename) {\n    return !/-out\\.js$/.test(filename) && !/-stderr$/.test(filename);\n});\n\nfunction run(test) {\n    function diffOutput(correct, got, name) {\n        if (got !== correct) {\n            const patch = diff.createPatch(name, correct, got);\n            process.stdout.write(patch);\n            process.stdout.write(\"\\n\\n\");\n        }\n    }\n\n    const noSuffix = test.slice(0, -3);\n    exec(fmt(\"{0} {1} defs-cmd {2}/{3}\", NODE, FLAG, pathToTests, test), function(error, stdout, stderr) {\n        stderr = stderr || \"\";\n        stdout = stdout || \"\";\n        const expectedStderr = slurp(fmt(\"{0}/{1}-stderr\", pathToTests, noSuffix));\n        const expectedStdout = slurp(fmt(\"{0}/{1}-out.js\", pathToTests, noSuffix));\n\n        const pass = (stderr === expectedStderr && stdout === expectedStdout);\n\n        if (!pass) {\n            console.log(fmt(\"FAILED test {0}\", test));\n        }\n        diffOutput(expectedStdout, stdout, fmt(\"{0}-out.js\", test));\n        diffOutput(expectedStderr, stderr, fmt(\"{0}-stderr\", test));\n    });\n}\n\nconst NODE = process.argv[0];\nconst FLAG = (process.argv[2] === \"es5\" ? \"\" : \"--harmony\");\ntests.forEach(run);\n"]}