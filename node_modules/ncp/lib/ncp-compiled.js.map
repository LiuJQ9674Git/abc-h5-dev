{"version":3,"sources":["ncp.js"],"names":[],"mappings":"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","file":"ncp-compiled.js","sourcesContent":["var fs = require('fs'),\n    path = require('path'),\n    util = require('util');\n\nconst modern = /^v0\\.1\\d\\.\\d+/.test(process.version);\n\nmodule.exports = ncp;\nncp.ncp = ncp;\n\nfunction ncp (source, dest, options, callback) {\n  var cback = callback;\n\n  if (!callback) {\n    cback = options;\n    options = {};\n  }\n\n  var basePath = process.cwd(),\n      currentPath = path.resolve(basePath, source),\n      targetPath = path.resolve(basePath, dest),\n      filter = options.filter,\n      rename = options.rename,\n      transform = options.transform,\n      clobber = options.clobber !== false,\n      modified = options.modified,\n      dereference = options.dereference,\n      errs = null,\n      eventName = modern ? 'finish' : 'close',\n      defer = modern ? setImmediate : process.nextTick,\n      started = 0,\n      finished = 0,\n      running = 0,\n      limit = options.limit || ncp.limit || 16;\n\n  limit = (limit < 1) ? 1 : (limit > 512) ? 512 : limit;\n\n  startCopy(currentPath);\n  \n  function startCopy(source) {\n    started++;\n    if (filter) {\n      if (filter instanceof RegExp) {\n        if (!filter.test(source)) {\n          return cb(true);\n        }\n      }\n      else if (typeof filter === 'function') {\n        if (!filter(source)) {\n          return cb(true);\n        }\n      }\n    }\n    return getStats(source);\n  }\n\n  function getStats(source) {\n    var stat = dereference ? fs.stat : fs.lstat;\n    if (running >= limit) {\n      return defer(function () {\n        getStats(source);\n      });\n    }\n    running++;\n    stat(source, function (err, stats) {\n      var item = {};\n      if (err) {\n        return onError(err);\n      }\n\n      // We need to get the mode from the stats object and preserve it.\n      item.name = source;\n      item.mode = stats.mode;\n      item.mtime = stats.mtime; //modified time\n      item.atime = stats.atime; //access time\n\n      if (stats.isDirectory()) {\n        return onDir(item);\n      }\n      else if (stats.isFile()) {\n        return onFile(item);\n      }\n      else if (stats.isSymbolicLink()) {\n        // Symlinks don't really need to know about the mode.\n        return onLink(source);\n      }\n    });\n  }\n\n  function onFile(file) {\n    var target = file.name.replace(currentPath, targetPath);\n    if(rename) {\n      target =  rename(target);\n    }\n    isWritable(target, function (writable) {\n      if (writable) {\n        return copyFile(file, target);\n      }\n      if(clobber) {\n        rmFile(target, function () {\n          copyFile(file, target);\n        });\n      }\n      if (modified) {\n        var stat = dereference ? fs.stat : fs.lstat;\n        stat(target, function(err, stats) {\n            //if souce modified time greater to target modified time copy file\n            if (file.mtime.getTime()>stats.mtime.getTime())\n                copyFile(file, target);\n            else return cb();\n        });\n      }\n      else {\n        return cb();\n      }\n    });\n  }\n\n  function copyFile(file, target) {\n    var readStream = fs.createReadStream(file.name),\n        writeStream = fs.createWriteStream(target, { mode: file.mode });\n    \n    readStream.on('error', onError);\n    writeStream.on('error', onError);\n    \n    if(transform) {\n      transform(readStream, writeStream, file);\n    } else {\n      writeStream.on('open', function() {\n        readStream.pipe(writeStream);\n      });\n    }\n    writeStream.once(eventName, function() {\n        if (modified) {\n            //target file modified date sync.\n            fs.utimesSync(target, file.atime, file.mtime);\n            cb();\n        }\n        else cb();\n    });\n  }\n\n  function rmFile(file, done) {\n    fs.unlink(file, function (err) {\n      if (err) {\n        return onError(err);\n      }\n      return done();\n    });\n  }\n\n  function onDir(dir) {\n    var target = dir.name.replace(currentPath, targetPath);\n    isWritable(target, function (writable) {\n      if (writable) {\n        return mkDir(dir, target);\n      }\n      copyDir(dir.name);\n    });\n  }\n\n  function mkDir(dir, target) {\n    fs.mkdir(target, dir.mode, function (err) {\n      if (err) {\n        return onError(err);\n      }\n      copyDir(dir.name);\n    });\n  }\n\n  function copyDir(dir) {\n    fs.readdir(dir, function (err, items) {\n      if (err) {\n        return onError(err);\n      }\n      items.forEach(function (item) {\n        startCopy(dir + '/' + item);\n      });\n      return cb();\n    });\n  }\n\n  function onLink(link) {\n    var target = link.replace(currentPath, targetPath);\n    fs.readlink(link, function (err, resolvedPath) {\n      if (err) {\n        return onError(err);\n      }\n      checkLink(resolvedPath, target);\n    });\n  }\n\n  function checkLink(resolvedPath, target) {\n    if (dereference) {\n      resolvedPath = path.resolve(basePath, resolvedPath);\n    }\n    isWritable(target, function (writable) {\n      if (writable) {\n        return makeLink(resolvedPath, target);\n      }\n      fs.readlink(target, function (err, targetDest) {\n        if (err) {\n          return onError(err);\n        }\n        if (dereference) {\n          targetDest = path.resolve(basePath, targetDest);\n        }\n        if (targetDest === resolvedPath) {\n          return cb();\n        }\n        return rmFile(target, function () {\n          makeLink(resolvedPath, target);\n        });\n      });\n    });\n  }\n\n  function makeLink(linkPath, target) {\n    fs.symlink(linkPath, target, function (err) {\n      if (err) {\n        return onError(err);\n      }\n      return cb();\n    });\n  }\n\n  function isWritable(path, done) {\n    fs.lstat(path, function (err) {\n      if (err) {\n        if (err.code === 'ENOENT') return done(true);\n        return done(false);\n      }\n      return done(false);\n    });\n  }\n\n  function onError(err) {\n    if (options.stopOnError) {\n      return cback(err);\n    }\n    else if (!errs && options.errs) {\n      errs = fs.createWriteStream(options.errs);\n    }\n    else if (!errs) {\n      errs = [];\n    }\n    if (typeof errs.write === 'undefined') {\n      errs.push(err);\n    }\n    else { \n      errs.write(err.stack + '\\n\\n');\n    }\n    return cb();\n  }\n\n  function cb(skipped) {\n    if (!skipped) running--;\n    finished++;\n    if ((started === finished) && (running === 0)) {\n      if (cback !== undefined ) {\n        return errs ? cback(errs) : cback(null);\n      }\n    }\n  }\n}\n\n\n"]}